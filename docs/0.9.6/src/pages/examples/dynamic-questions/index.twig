{% extends "../../../layout.twig" %}

{% set page_title = 'Dynamic questions' %}
{% set page_slug = '/examples/' %}


{% block page %}
    <h1><a href="#dynamic-questions" id="dynamic-questions" class="anchor"></a>{{page_title}}</h1>
    
    <div class="row cfdoc-example-row">
    	<div class="col-md-12 col-lg-6">
            <p>A crude example of validating user response using <code>flowStepCallback</code> and feeding new questions based on your answers. In this example we just feed random questions, but it could obviously be a servers-side logic that would take care of generating new questions based on their answers.</p>
    		
            <!-- Conversational Form will auto-run because of attribute "cf-form" -->
            <p>The form:</p>
            <form id="form">
                <input type="text" id="firstname" placeholder="firstname" cf-questions="Please write your firstname" />
                <p>In this example we'll inject some questions in between these two inputs.</p>
                <input type="text" id="was it fun?" placeholder="how was it?" cf-questions="{firstname}, please tell us how your experience was..." />
            </form>

    	</div>
    	<div class="col-md-12 col-lg-6 cfdoc-example">
    		<div id="cf-context" role="cf-context" cf-context></div>
    	</div>

        <script>
            var flowCallback = function(dto, success, error){
                console.log("dto....", dto, success, error);
                
                /*
                The concept is that this could just as well be an AJAX request to your server where the response would yield a new qeustion that would be injected into the form.
                 */ 
                if(window.incrementedValue < 3){
                    window.incrementedValue++;
                    window.ConversationalForm.addTags([{"tag":"select","name":"country","cf-questions":"Where are you from? (I have asked you this " + window.incrementedValue + " time(s))","cf-input-placeholder":"country code","multiple":false,"children":[{"tag":"option","cf-label":"USA","value":"usa"},{"tag":"option","cf-label":"UK","value":"uk"}]}]);
                }

                // We assume every answer is valid. If that wasnt the case we would call error()
                success();
            };

            // called from examples code
            function initExample(){
                window.incrementedValue = 0;
                var conversationalForm = window.cf.ConversationalForm.startTheConversation({
                    formEl: document.getElementById("form"),
                    context: document.getElementById("cf-context"),
                    flowStepCallback: flowCallback,
                    submitCallback: function(){
                        conversationalForm.addRobotChatResponse("You are done. Thank you.");
                    }
                });
            }
        </script>
    </div>
	
{% endblock %}